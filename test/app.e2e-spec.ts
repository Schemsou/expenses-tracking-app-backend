import { Test, TestingModule } from '@nestjs/testing';
import { INestApplication } from '@nestjs/common';
import * as request from 'supertest';
import { AppModule } from './../src/app.module';

describe('ExpensesController (e2e)', () => {
  let app: INestApplication;

  beforeEach(async () => {
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    await app.init();
  });

  it('/expenses (GET)', () => {
    return request(app.getHttpServer())
      .get('/expenses')
      .expect(200)
      .expect([
        {
          _id: '6501b55885ae619b3500fc84',
          title: 'Example Expense',
          amount: 60,
          date: '2023-09-13T13:05:38.707Z',
          category: 'Bills',
          description: 'A description of the expense',
          user: '6501717f43cde31f65a013e6',
          createdAt: '2023-09-13T13:12:56.329Z',
          updatedAt: '2023-09-13T13:12:56.329Z',
          __v: 0,
        },
        {
          _id: '6501b57285ae619b3500fc8d',
          title: 'Example Expense',
          amount: 10,
          date: '2023-09-13T13:05:38.707Z',
          category: 'Bills',
          description: 'A description of the expense',
          user: '6501717f43cde31f65a013e6',
          createdAt: '2023-09-13T13:13:22.180Z',
          updatedAt: '2023-09-13T13:13:22.180Z',
          __v: 0,
        },
        {
          _id: '6501b58985ae619b3500fc93',
          title: 'Example Expense',
          amount: 10,
          date: '2023-09-13T13:05:38.707Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '6501717f43cde31f65a013e6',
          createdAt: '2023-09-13T13:13:45.329Z',
          updatedAt: '2023-09-13T13:13:45.329Z',
          __v: 0,
        },
        {
          _id: '6501bf64fa30d540c6b728c6',
          title: 'Example Expense',
          amount: 20,
          date: '2023-09-13T13:51:19.522Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '6501717f43cde31f65a013e6',
          createdAt: '2023-09-13T13:55:48.518Z',
          updatedAt: '2023-09-13T13:55:48.518Z',
          __v: 0,
        },
        {
          _id: '6501cfe1e435a703e23d9197',
          title: 'Example Expense',
          amount: 20,
          date: '2023-09-13T15:04:40.635Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '6501717f43cde31f65a013e6',
          createdAt: '2023-09-13T15:06:09.728Z',
          updatedAt: '2023-09-13T15:06:09.728Z',
          __v: 0,
        },
        {
          _id: '6501d1b86439d33bc8da3f09',
          title: 'Example Expense',
          amount: 100,
          date: '2023-09-12T14:36:05.331Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T15:14:00.937Z',
          updatedAt: '2023-09-13T15:14:00.937Z',
          __v: 0,
        },
        {
          _id: '6501d36427abd89c04ef6e63',
          title: 'Example Expense',
          amount: 100,
          date: '2023-09-13T15:15:45.203Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T15:21:08.273Z',
          updatedAt: '2023-09-13T15:21:08.273Z',
          __v: 0,
        },
        {
          _id: '6501d38427abd89c04ef6e7e',
          title: 'Example Expense',
          amount: 100,
          date: '2023-09-13T15:15:45.203Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T15:21:40.439Z',
          updatedAt: '2023-09-13T15:21:40.439Z',
          __v: 0,
        },
        {
          _id: '6501d3c127abd89c04ef6e9c',
          title: 'Example Expense',
          amount: 100,
          date: '2023-09-13T15:15:45.203Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T15:22:41.568Z',
          updatedAt: '2023-09-13T15:22:41.568Z',
          __v: 0,
        },
        {
          _id: '6501e15c6439d33bc8da3f0d',
          title: 'Example Expense',
          amount: 100,
          date: '2023-09-12T14:36:05.331Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T16:20:44.867Z',
          updatedAt: '2023-09-13T16:20:44.867Z',
          __v: 0,
        },
        {
          _id: '6501e2e76439d33bc8da3f13',
          title: 'Example Expense',
          amount: 100,
          date: '2023-09-12T14:36:05.331Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T16:27:19.527Z',
          updatedAt: '2023-09-13T16:27:19.527Z',
          __v: 0,
        },
        {
          _id: '6501e5ea6439d33bc8da3f19',
          title: 'fff',
          amount: 2222,
          date: '2023-09-12T14:36:05.331Z',
          category: 'Food',
          description: 'ddddd',
          user: '64ff79f52e2a8e9ce7bee9c9',
          createdAt: '2023-09-13T16:40:10.532Z',
          updatedAt: '2023-09-13T16:40:10.532Z',
          __v: 0,
        },
        {
          _id: '6501ecfb6439d33bc8da3f1d',
          title: 'ggg',
          amount: 22222,
          date: '2023-09-12T14:36:05.331Z',
          category: 'Bills',
          description: 'rfgfgd',
          user: '64ff79f52e2a8e9ce7bee9c9',
          createdAt: '2023-09-13T17:10:19.136Z',
          updatedAt: '2023-09-13T17:10:19.136Z',
          __v: 0,
        },
        {
          _id: '6501eda86439d33bc8da3f20',
          title: 'Example Expense',
          amount: 100,
          date: '2023-09-12T14:36:05.331Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T17:13:12.106Z',
          updatedAt: '2023-09-13T17:13:12.106Z',
          __v: 0,
        },
        {
          _id: '6501efe56439d33bc8da3f26',
          title: 'fffff',
          amount: 233,
          date: '2023-09-12T14:36:05.331Z',
          category: 'Food',
          description: 'ffffggg',
          user: '64ff79f52e2a8e9ce7bee9c9',
          createdAt: '2023-09-13T17:22:45.770Z',
          updatedAt: '2023-09-13T17:22:45.770Z',
          __v: 0,
        },
        {
          _id: '6501f9ef6439d33bc8da3f2d',
          title: 'Example Expense',
          amount: 1200,
          date: '2023-09-12T14:36:05.331Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T18:05:35.853Z',
          updatedAt: '2023-09-13T18:05:35.853Z',
          __v: 0,
        },
        {
          _id: '6501fbe145542ad6299711d7',
          title: 'Example Expense',
          amount: 1200,
          date: '2023-09-13T18:09:51.327Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T18:13:53.968Z',
          updatedAt: '2023-09-13T18:13:53.968Z',
          __v: 0,
        },
        {
          _id: '6501fc1345542ad6299711db',
          title: 'Example Expense',
          amount: 1230,
          date: '2023-09-13T18:09:51.327Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T18:14:43.754Z',
          updatedAt: '2023-09-13T18:14:43.754Z',
          __v: 0,
        },
        {
          _id: '6501fc4645542ad6299711df',
          title: 'Example Expense',
          amount: 1230,
          date: '2023-09-13T18:09:51.327Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T18:15:34.034Z',
          updatedAt: '2023-09-13T18:15:34.034Z',
          __v: 0,
        },
        {
          _id: '6501fc7245542ad6299711e4',
          title: 'Example Expense',
          amount: 1230,
          date: '2023-09-13T18:09:51.327Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-13T18:16:18.331Z',
          updatedAt: '2023-09-13T18:16:18.331Z',
          __v: 0,
        },
        {
          _id: '650205e245542ad62997122e',
          title: "Today's food",
          amount: 1212,
          date: '2023-09-13T18:09:51.327Z',
          category: 'Food',
          description: 'ddsdsddfffrfer',
          user: '64ff79f52e2a8e9ce7bee9c9',
          createdAt: '2023-09-13T18:56:34.262Z',
          updatedAt: '2023-09-13T18:56:34.262Z',
          __v: 0,
        },
        {
          _id: '6502115345542ad6299712e8',
          title: 'todays',
          amount: 66788,
          date: '2023-09-13T18:09:51.327Z',
          category: 'Food',
          description: 'dfghjklm',
          user: '64ff79f52e2a8e9ce7bee9c9',
          createdAt: '2023-09-13T19:45:23.449Z',
          updatedAt: '2023-09-13T19:45:23.449Z',
          __v: 0,
        },
        {
          _id: '6502186c45542ad6299712f4',
          title: 'voyage',
          amount: 22222,
          date: '2023-09-13T18:09:51.327Z',
          category: 'Travel',
          description: 'nice',
          user: '650217e045542ad6299712f0',
          createdAt: '2023-09-13T20:15:40.755Z',
          updatedAt: '2023-09-13T20:15:40.755Z',
          __v: 0,
        },
        {
          _id: '65023340cc9982af38444e38',
          title: 'test',
          amount: 98,
          date: '2023-09-13T22:08:54.572Z',
          category: 'Food',
          user: '6500e0ce0100f83eefd3d082',
          createdAt: '2023-09-13T22:10:08.802Z',
          updatedAt: '2023-09-13T22:10:08.802Z',
          __v: 0,
        },
        {
          _id: '65023356cc9982af38444e3b',
          title: 'test',
          amount: 98,
          date: '2023-09-13T13:12:56.329Z',
          category: 'Food',
          user: '6500e0ce0100f83eefd3d082',
          createdAt: '2023-09-13T22:10:30.206Z',
          updatedAt: '2023-09-13T22:10:30.206Z',
          __v: 0,
        },
        {
          _id: '65023362cc9982af38444e3e',
          title: 'test',
          amount: 98,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '6500e0ce0100f83eefd3d082',
          createdAt: '2023-09-13T22:10:42.420Z',
          updatedAt: '2023-09-13T22:10:42.420Z',
          __v: 0,
        },
        {
          _id: '65023424f0f3d5e7b90d2df2',
          title: 'test',
          amount: 98,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '6500e0ce0100f83eefd3d082',
          createdAt: '2023-09-13T22:13:56.039Z',
          updatedAt: '2023-09-13T22:13:56.039Z',
          __v: 0,
        },
        {
          _id: '65023481f0f3d5e7b90d2df6',
          title: 'titre',
          amount: 44,
          date: '2023-09-13T22:13:44.606Z',
          category: 'Food',
          description: 'desc',
          user: '650217e045542ad6299712f0',
          createdAt: '2023-09-13T22:15:29.192Z',
          updatedAt: '2023-09-13T22:15:29.192Z',
          __v: 0,
        },
        {
          _id: '6502ffc44658f6b10dc291a8',
          title: 'Example Expense',
          amount: 1230,
          date: '2023-09-13T00:00:00.000Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-14T12:42:44.273Z',
          updatedAt: '2023-09-14T12:42:44.273Z',
          __v: 0,
        },
        {
          _id: '650302c84658f6b10dc291ac',
          title: "Today's food",
          amount: 22223,
          date: '2023-09-28T00:00:00.000Z',
          category: 'Food',
          description: 'jjjj',
          user: '64ff79f52e2a8e9ce7bee9c9',
          createdAt: '2023-09-14T12:55:36.428Z',
          updatedAt: '2023-09-14T12:55:36.428Z',
          __v: 0,
        },
        {
          _id: '650303294658f6b10dc291af',
          title: 'aaz',
          amount: 3334,
          date: '2023-09-06T00:00:00.000Z',
          category: 'Bills',
          description: 'sssssd',
          user: '64ff79f52e2a8e9ce7bee9c9',
          createdAt: '2023-09-14T12:57:13.932Z',
          updatedAt: '2023-09-14T12:57:13.932Z',
          __v: 0,
        },
        {
          _id: '65062e301da3f181b5ee9264',
          title: 'test',
          amount: 98,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '6500e0ce0100f83eefd3d082',
          createdAt: '2023-09-16T22:37:36.912Z',
          updatedAt: '2023-09-16T22:37:36.912Z',
          __v: 0,
        },
        {
          _id: '65062e46c2303622d02958ee',
          title: 'Example 9',
          amount: 623,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '6500e0ce0100f83eefd3d082',
          createdAt: '2023-09-16T22:37:58.034Z',
          updatedAt: '2023-09-16T22:38:22.230Z',
          __v: 0,
        },
        {
          _id: '6506301a99a948040f58d41c',
          title: 'test',
          amount: 80,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '650217e045542ad6299712f0',
          createdAt: '2023-09-16T22:45:46.612Z',
          updatedAt: '2023-09-16T22:45:46.612Z',
          __v: 0,
        },
        {
          _id: '650633917c82e3a128869f83',
          title: 'Example Expense',
          amount: 100,
          date: '2023-09-16T22:59:50.046Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-16T23:00:33.119Z',
          updatedAt: '2023-09-16T23:00:33.119Z',
          __v: 0,
        },
        {
          _id: '650633a97c82e3a128869f9e',
          title: 'Example Expense',
          amount: 100,
          date: '2023-09-16T22:59:50.046Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-16T23:00:57.869Z',
          updatedAt: '2023-09-16T23:00:57.869Z',
          __v: 0,
        },
        {
          _id: '65063803a4af32047153de2d',
          title: 'Example Expense',
          amount: 100,
          date: '2023-09-16T23:15:12.084Z',
          category: 'Food',
          description: 'A description of the expense',
          user: '64fe1cd9e3683cab709bcfaa',
          createdAt: '2023-09-16T23:19:31.982Z',
          updatedAt: '2023-09-16T23:19:31.982Z',
          __v: 0,
        },
        {
          _id: '65063c205f49fc34ce77dc0a',
          title: 'test',
          amount: 80,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '650217e045542ad6299712f0',
          createdAt: '2023-09-16T23:37:04.893Z',
          updatedAt: '2023-09-16T23:37:04.893Z',
          __v: 0,
        },
        {
          _id: '65063d9177c87b354d642afb',
          title: 'test',
          amount: 80,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '650217e045542ad6299712f0',
          createdAt: '2023-09-16T23:43:13.736Z',
          updatedAt: '2023-09-16T23:43:13.736Z',
          __v: 0,
        },
        {
          _id: '65063dcab284e5f241a07fb8',
          title: 'test',
          amount: 80,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '650217e045542ad6299712f0',
          createdAt: '2023-09-16T23:44:10.204Z',
          updatedAt: '2023-09-16T23:44:10.204Z',
          __v: 0,
        },
        {
          _id: '65063dfff94e47f1e7f1da38',
          title: 'test',
          amount: 80,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '650217e045542ad6299712f0',
          createdAt: '2023-09-16T23:45:03.304Z',
          updatedAt: '2023-09-16T23:45:03.304Z',
          __v: 0,
        },
        {
          _id: '65063ea5951833bb3fc3d605',
          title: 'test',
          amount: 80,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '650217e045542ad6299712f0',
          createdAt: '2023-09-16T23:47:49.157Z',
          updatedAt: '2023-09-16T23:47:49.157Z',
          __v: 0,
        },
        {
          _id: '6506406473dc7978c8360871',
          title: 'test',
          amount: 80,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '650217e045542ad6299712f0',
          createdAt: '2023-09-16T23:55:16.121Z',
          updatedAt: '2023-09-16T23:55:16.121Z',
          __v: 0,
        },
        {
          _id: '650640fda896286722e3154e',
          title: 'test',
          amount: 80,
          date: '2023-11-13T13:12:56.329Z',
          category: 'Food',
          user: '650217e045542ad6299712f0',
          createdAt: '2023-09-16T23:57:49.359Z',
          updatedAt: '2023-09-16T23:57:49.359Z',
          __v: 0,
        },
      ]);
  });

  it('/expenses/add (POST)', () => {
    const expenseData = {
      title: 'test',
      amount: 80,
      date: '2023-11-13T13:12:56.329Z',
      category: 'Food',
    };
    const token =
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY1MDIxN2UwNDU1NDJhZDYyOTk3MTJmMCIsImlhdCI6MTY5NDkwNDMyMywiZXhwIjoxNjk3NDk2MzIzfQ.8gHgCit37YwMO6Rfnhxy76WkRWfcbIPHGOz28g7Q1qM';

    return request(app.getHttpServer())
      .post('/expenses/add')
      .set('Authorization', `Bearer ${token}`)
      .send(expenseData)
      .expect(201);
  });

  it('/expenses/:expenseId (GET)', () => {
    const expenseId = '6502ffc44658f6b10dc291a8';
    const token =
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY1MDIxN2UwNDU1NDJhZDYyOTk3MTJmMCIsImlhdCI6MTY5NDkwNDMyMywiZXhwIjoxNjk3NDk2MzIzfQ.8gHgCit37YwMO6Rfnhxy76WkRWfcbIPHGOz28g7Q1qM';

    return request(app.getHttpServer())
      .get(`/expenses/${expenseId}`)
      .set('Authorization', `Bearer ${token}`)
      .expect(200)
      .expect({
        _id: '6502ffc44658f6b10dc291a8',
        title: 'Example Expense',
        amount: 1230,
        date: '2023-09-13T00:00:00.000Z',
        category: 'Food',
        description: 'A description of the expense',
        user: '64fe1cd9e3683cab709bcfaa',
        createdAt: '2023-09-14T12:42:44.273Z',
        updatedAt: '2023-09-14T12:42:44.273Z',
        __v: 0,
      });
  });

  afterAll(async () => {
    await app.close();
  });
});
